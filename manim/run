#!/bin/bash -x
#
#
# ./run "Custom hex color" "#ffcc00"

# ./run "Hello world" "#ffcc00" 32 1.5 -0.3

folder=${folder:-none}
rm -rf /home/node/tts/$folder/media
colors=(orange)


COLOR_DEFAULT="${colors[RANDOM % ${#colors[@]}]}"
cp -a simple.py /home/node/tts/$folder/

  #-v "$(pwd)":/manim \
docker run --rm \
  -v "/home/node/tts/$folder":/manim \
  -u "$(id -u)":"$(id -g)" \
  -e TEXT="${1:-Hello 1from Manim! test tomer baum nine big words}" \
  -e COLOR="$COLOR_DEFAULT" \
  -e FONT_SIZE="${2:-50}" \
  -e SHIFT_X="${3:-1.0}" \
  -e SHIFT_Y="${4:-0.0}" \
  manimcommunity/manim \
   manim -ql -t -o text_alpha.webm ./simple.py TextScene
#  manim -ql ./text_scene.py TextScene


  

ffmpeg1(){

  #cd media/videos/text_scene/480p15
  cd /home/node/tts/$folder
 cd media/videos/simple/480p15
pwd
ls -ltr 
sleep 1
# ffmpeg -i /home/node/tts/$folder/back-for-before.mp4 -i text_alpha.webm.mov \
#  -filter_complex "[1:v]scale=1920:-1[fg];[0:v][fg]overlay=0:0:format=auto" \
#  -c:v libx264 -pix_fmt yuv420p -c:a copy back-for-beforez.mp4 -y
#  cp -a back-for-beforez.mp4 /home/node/tts/$folder/

#ffmpeg -i text_alpha.webm.mov -c:v libvpx-vp9 -pix_fmt yuva420p text_alpha_yuva.webm -y




  ffmpeg -i /home/node/tts/$folder/back-45.mp4 \
  -itsoffset $s -i text_alpha.webm.mov \
  -filter_complex "[1:v]scale=1920:-1[fg];[0:v][fg]overlay=0:H-h-110:format=auto:shortest=1" \
  -c:v libx264 -pix_fmt yuv420p -c:a copy back-for-beforez.mp4 -y
ls -ltr
pwd
sleep 1
  cp -a back-for-beforez.mp4 /home/node/tts/$folder/

#ffmpeg -i /home/node/tts/$folder/back-for-before_m0.mp4 \
#  -itsoffset $seconds -i text_alpha.webm.mov \
#  -filter_complex "[1:v]scale=1920:-1[fg];[0:v][fg]overlay=0:80:format=auto:eof_action=pass" \
#  -map 0:v -map 0:a? -c:v libx264 -pix_fmt yuv420p -c:a copy back-for-beforez.mp4 -y
#  cp -a back-for-beforez.mp4 /home/node/tts/$folder/


  }



  s=5 ffmpeg1
  cp -a /home/node/tts/$folder/back-for-beforez.mp4 /mnt/c/ffmpeg/c/
